### 1. 项目说明

项目初衷：

某天突然发现了GC9A01这款1.28英寸的圆形TFT屏幕，正好当时在学习ESP32以及LVGL这款开源嵌入式GUI库，于是加在一起，自然而然就想到了做一款圆形手表。

项目定位：

demo项目，本意是用来验证esp32是否能够GC9A01这款1.28英寸屏幕，以及LVGL学习板。

项目功能：

1. 开机动画：在上电时播放开机动画，初始化例如网络信息的获取在此阶段完成
2. 多级菜单：分为三级菜单(如果把主页面和功能选择页面放在一级的话就是两级页面)，能够正常地进入和退出菜单，并能能够使用页面上提供的功能。
3. 天气信息：提供从今天起的未来三天的天气信息，并且展示在页面上。
4. 计时功能：正计时、番茄钟(项目中未实现)、闹钟(项目中未实现)。
5. 游戏功能：内置一款谷歌恐龙小游戏(仅绘制页面以及实现部分基本逻辑，未验证是否可行)。
6. 视频播放：播放badapple动画(TF卡功能未实现暂且放弃)。
7. 功能设置：对背光、网络信息更新频率、

### 2. 目录结构  

- doc      ---用来存放相关datasheet等文档3
- hardware  ---用来存放硬件部分原理图和PCB等文件
  - name_CAM  :文件，发给PCB板厂
  - name_PRJ :工程文件，原理图以及PCB文件等
  - name_BOM :物料文件
  - name_ASM :贴片文件，发送给贴片厂
- model      ---用来存放外壳或者其他模型文件
- sofeware   ---用来存放软件等相关内容
  - lib     --用来存放外设的库文件等
  - esp32_watch(LVGL)   -- 使用LVGL来实现，但功能不全，可供参考
  - esp32_watch  --软件项目，使用TFT_eSPI库来绘制
- README.md    ---项目readme文件

### 3. 项目结构

**硬件**：

主控：ESP32-WROOM-32，240Mhz主频，蓝牙WIFI模块，4M FLASH；

屏幕：GC9A01驱动1.28英寸TFT；

锂电池充电：TP5400，单节锂电池充电，可升压至5V，最大充电电流1A；

指示灯：WS2812B，RGB三色，256级亮度显示；

其他：一个TF卡座，一个5020封装的无源蜂鸣器，三个按键；



**软件**：

软件项目使用arduino平台进行开发，使用C++作为主要开发语言，其中，可以使用TFT_eSPI库来驱动TFT屏幕、FastLED库来驱动WS2812B、Bounces2库来实现按键功能，按键功能定义为 menu_button:返回上一级页面，next_button:显示同级的下一个内容，ok_button:确认选择，。

软件运行逻辑：

开机动画 - -> 硬件初始化 --> 主页面 - -> 按键动作 - - > 二级菜单 - - > 按键动作- - >三级菜单

其中，一级菜单：mian_ui 显示图片、星期、日记、时间等信息，并且监听按键动作，有任意按键动作则进入二级菜单；

二级菜单：list_ui 显示功能选择，监听动作，根据案件动作进入不同的页面；

三级页面： 

* weather_ui:显示天气信息，默认当天天气，按下next按键则显示下一天信息；
* clock_ui: 实现正计时功能，ok按键表示暂停或者开始，next按键表示重新开始，menu返回上一级；
* game_ui:实现游戏
* video_ui: 播放视频，或者可以实现电子相册功能
* net_ui: 进入该页面，配网程序自动开始，除非重新配网或者重启，否则不会重新工作；
* setup_ui:进行一些设置



多级菜单的实现：

在此仅指明我所了解的几种方式：

* 新建一个函数指针，在loop中运行该函数，在每一个页面监听按键的变化，根据按键的变化，将函数指针指向不同的函数，也是本项目使用的方式；
* 索引法：具体方式可查看该链接：https://blog.csdn.net/black_sneak/article/details/126442559?spm=1001.2014.3001.5506
* 链表法：维护一个链表，将菜单层级在该链表上实现

**模型** ：

暂未设计外壳。

### 4. 上手指南

项目采用VScode+platformio插件使用C++进行开发，VScode下载后需要下载C++插件、platformio插件，其中platformio因其服务器原因，在第一次新建项目时速度较慢，可以尝试使用手机热点或者科学上网的方式。

使用VScode打开项目，点击编译，下载，即可进行程序的下载。

在尝试复刻硬件项目时，可以考虑加入一颗USB转TTL芯片例如CP2012来做自动下载，这样方便后续调试，否则在下载时，在重新上电时需要将GPIO0对地短接，芯片才能进行烧录模式，烧录完成后重新上电，程序就能够正常运行。

演示画面可以查看该链接：https://www.bilibili.com/video/BV1F84y1p77C/?vd_source=fcd63c592e333153bb30b020f4c31b77



### 5. 不足点以及改进方向

**硬件**：

* 可以使用一颗USB转TTL芯片来做自动下载，手动将GPIO0对地短接对于下载过于麻烦；
* TF卡功能并没有实现，一开始怀疑是屏幕使用的SPI会对TF卡的SPI造成干扰，但是使用ESP32的开发板并没有发现该现象，怀疑是TF卡封装引脚画错了，TF卡对于该项目至关重要，因为彩色图片取模后的数据非常大，而不使用图片则失去了使用TFT屏幕的意义；
* 如果需要继续缩小体积，可以使用ESP32-pico-d4这款QFN的芯片，但是天线需要自己设计，不管是使用板载天线还是贴片陶瓷天线，都没有把握；
* 屏幕需要放在正面，因为屏幕排线较短，画板时没有考虑这一点，虽然使用没有太大影响，但是不美观，而且FPC上引脚也容易断；
* 锂电池充电IC可以使用TP4057这款SOT23-6封装的IC，并且将TP4057的CHRG引脚和PROG引脚接到ESP32上，判断这两个引脚的电平，则可以判断是否在充电和充电是否已完成。
* 板框可以画成两端突出，方便后续增加表带；

**软件**：

* 暂不清楚TFT_eSPI库的更新方式，所以有时候会出现，明明在改变函数指向时做了一次清屏操作，或者填充操作，但是该操作并未生效，只能在切换页面后，判断一次是不是需要做一次清屏操作然后做一次清屏操作；
* LVGL库是为触摸屏开发的，虽然提供了API来适配键盘和编码器，但是在使用时并不方便，做了多层封装以至于让人难以对具体的功能进行把握，且LVGL仅对单个页面，对于页面之间的切换，并没有提供一个思路或者方法，且LVGL占用空间实在是太大了，对于ESP32来说都有点捉襟见肘，所以本项目仅使用了TFT_eSPI库来对屏幕进行控制；
* 虽然使用了C++，但是并没有使用class的方式来进行书写，写法还是面向过程；



### 6. 贡献者及资料



